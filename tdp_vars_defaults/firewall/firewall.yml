# Copyright 2022 TOSIT.IO
# SPDX-License-Identifier: Apache-2.0

---
# Should TDP manage firewall rules on cluster nodes
firewall_tdp_managed: no
# Only takes effect if 'firewall_tdp_managed: yes'
firewall_start_on_boot: no
# For now only 'firewalld' is supported
firewall_service: firewalld

firewalld_files_prefix: tdp_

# 'groups' and/or 'addresses' has to be != [] in order for the zone to take effect
# One source can only be used in one zone
firewalld_zones:
  - name: public
    short: TDP cluster public zone
    groups: []
    addresses:
      - 0.0.0.0/1
      - 128.0.0.0/1
  - name: internal
    short: TDP cluster internal zone
    groups:
      - tdp_cluster
    addresses: []

firewalld_rules:
  # Kerberos/LDAP
  kdc:
    - name: kerberos_kdc_tcp
      short: Kerberos KDC TCP port
      port: "{{ kerberos_kdc_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present
    - name: kerberos_kdc_udp
      short: Kerberos KDC UDP port
      port: "{{ kerberos_kdc_port }}"
      protocol: udp
      zones:
        - internal
        - public
      state: present
    - name: kerberos_admin_tdp
      short: Kerberos Admin TCP port
      port: "{{ kerberos_admin_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present
    - name: kerberos_admin_udp
      short: Kerberos Admin UDP port
      port: "{{ kerberos_admin_port }}"
      protocol: udp
      zones:
        - internal
        - public
      state: present
  kdcproxy:
    - name: kerberos_kdcproxy
      short: Kerberos KDC Proxy port
      port: "{{ kerberos_kdcproxy_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present
  ldap:
    - name: openldap_server
      short: OpenLDAP port
      port: "{{ openldap_server_ldaps_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present

  # PostgreSQL
  postgresql:
    - name: postgresql_server
      short: PostgreSQL port
      port: "{{ postgresql_server_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present

  # Ranger
  ranger_solr:
    - name: ranger_solr_http_port
      short: Ranger Solr HTTP port
      port: "{{ ranger_solr_http_port }}"
      protocol: tcp
      zones:
        - internal
      state: present
  ranger_admin:
    - name: ranger_adm_https_port
      short: Ranger Admin HTTPS port
      port: "{{ ranger_adm_https_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present
  ranger_usersync:
    - name: ranger_usersync_https_port
      short: Ranger Usersync HTTPS port
      port: "{{ ranger_usersync_https_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present
  ranger_kms:
    - name: ranger_kms_https_port
      short: Ranger KMS HTTPS port
      port: "{{ ranger_kms_https_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present

  # ZooKeeper
  zk:
    - name: zookeeper_server_quorum_port
      short: ZooKeeper Server quorum port
      port: "{{ zookeeper_server_quorum_port }}"
      protocol: tcp
      zones:
        - internal
      state: present
    - name: zookeeper_server_election_port
      short: ZooKeeper Server election port
      port: "{{ zookeeper_server_election_port }}"
      protocol: tcp
      zones:
        - internal
      state: present
    - name: zookeeper_server_client_port
      short: ZooKeeper Server client port
      port: "{{ zookeeper_server_client_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present

  # HDFS
  hdfs_nn:
    - name: hdfs_zkfc_rpc_port
      short: HDFS ZooKeeper Failover Controller RPC port
      port: "{{ hdfs_zkfc_rpc_port }}"
      protocol: tcp
      zones:
        - internal
      state: present
    - name: hdfs_nn_rpc_port
      short: HDFS NameNode RPC port
      port: "{{ hdfs_nn_rpc_port }}"
      protocol: tcp
      zones:
        - internal
      state: present
    - name: hdfs_nn_https_port
      short: HDFS NameNode HTTPS port
      port: "{{ hdfs_nn_https_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present
  hdfs_dn:
    - name: hdfs_dn_data_port
      short: HDFS DataNode data transfer port
      port: "{{ hdfs_dn_data_port }}"
      protocol: tcp
      zones:
        - internal
      state: present
    - name: hdfs_dn_ipc_port
      short: HDFS DataNode metadata port
      port: "{{ hdfs_dn_ipc_port }}"
      protocol: tcp
      zones:
        - internal
      state: present
    # Public ports
    - name: hdfs_dn_https_port
      short: HDFS DataNode HTTPS port
      port: "{{ hdfs_dn_https_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present
  hdfs_jn:
    - name: hdfs_jn_rpc_port
      short: HDFS JournalNode RPC port
      port: "{{ hdfs_jn_rpc_port }}"
      protocol: tcp
      zones:
        - internal
      state: present
    - name: hdfs_jn_https_port
      short: HDFS JournalNode HTTPS port
      port: "{{ hdfs_jn_https_port }}"
      protocol: tcp
      zones:
        - internal
        - public
      state: present
