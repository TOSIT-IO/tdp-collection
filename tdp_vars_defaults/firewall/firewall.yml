# Copyright 2022 TOSIT.IO
# SPDX-License-Identifier: Apache-2.0

---
# Should TDP manage firewall rules on cluster nodes
firewall_tdp_managed: yes
# Only takes effect if 'firewall_tdp_managed: yes'
firewall_start_on_boot: no
# For now only 'firewalld' is supported
firewall_service: firewalld

firewalld_files_prefix: tdp_

# 'groups' and/or 'addresses' has to be != [] in order for the zone to take effect
# One source can only be used in one zone
firewalld_zones:
  - name: public
    short: TDP cluster public zone
    groups: []
    addresses:
      - 192.168.56.0/23
  - name: internal
    short: TDP cluster internal zone
    groups:
      - tdp_cluster
    addresses: []

firewalld_rules:
  # Rules created on all hosts
  tdp_cluster:
    - name: ssh
      short: SSH port
      port: 22
      protocol: tcp
      zones:
        - public
      state: present

  # Rules created on HDFS DataNode hosts
  hdfs_dn:
    # Internal ports
    - name: hdfs_dn_data_port
      short: HDFS DataNode data transfer port
      port: "{{ hdfs_dn_data_port }}"
      protocol: tcp
      zones:
        - internal
      state: present
    - name: hdfs_dn_ipc_port
      short: HDFS DataNode metadata port
      port: "{{ hdfs_dn_ipc_port }}"
      protocol: tcp
      zones:
        - internal
      state: present
    # Public ports
    - name: hdfs_dn_https_port
      short: HDFS DataNode Web UI port
      port: "{{ hdfs_dn_https_port }}"
      protocol: tcp
      zones:
        - public
      state: present
