---
- import_role:
    name: tosit.tdp.knox.common
    tasks_from: install

- name: Create configuration directory
  file:
    path: '{{ knox_conf_dir }}'
    state: directory
    group: '{{ knox_group }}'
    owner: '{{ knox_user }}'

- name: Create configuration subdirectories
  file:
    path: '{{ knox_conf_dir }}/{{ item }}'
    state: directory
    group: '{{ knox_group }}'
    owner: '{{ knox_user }}'
  loop:
    - descriptors
    - shared-providers
    - topologies

- name: Create data directories
  file:
    path: '{{ item }}'
    state: directory
    group: '{{ knox_group }}'
    owner: '{{ knox_user }}'
  loop:
    - "{{ gateway_site['gateway.data.dir'] }}"
    - "{{ gateway_site['gateway.security.dir'] }}"
    - "{{ gateway_site['gateway.deployment.dir'] }}"
    #- "{{ gateway_site['gateway.services.dir']  }}"

- name: Copy services defition to data directory
  copy:
    src: "{{ knox_install_dir }}/data/services"
    dest: "{{ knox_data_dir }}/data/"
    group: '{{ knox_group }}'
    owner: '{{ knox_user }}'
    remote_src: yes
