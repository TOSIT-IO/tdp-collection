# Copyright 2022 TOSIT.IO
# SPDX-License-Identifier: Apache-2.0

---
- name: kinit hdfs NN
  ansible.builtin.command: kinit -kt /etc/security/keytabs/nn.service.keytab nn/{{ ansible_hostname | tosit.tdp.access_fqdn(hostvars) }}@{{ realm }}
  become: true
  become_user: hdfs
  changed_when: false

- name: Check HDFS node status and datanode usage
  ansible.builtin.command: hdfs dfsadmin -report
  register: storage_output
  become: true
  become_user: hdfs
  changed_when: false

- name: Print output of HDFS node status and datanode usage
  ansible.builtin.debug:
    msg: "{{ storage_output.stdout }}"

- name: Check HDFS block replication status
  ansible.builtin.command: hdfs fsck /
  register: block_replication_output
  become: true
  become_user: hdfs
  changed_when: false

- name: Print output of block replication status
  ansible.builtin.debug:
    msg: "{{ block_replication_output.stdout }}"
