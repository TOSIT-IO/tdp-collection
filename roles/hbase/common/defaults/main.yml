---
# HBase version
hbase_release: hbase-2.1.10-TDP-0.1.0-SNAPSHOT
hbase_dist_file: "{{ hbase_release }}-bin.tar.gz"

# HBase users and group
hdfs_user: hdfs
hbase_user: hbase
hadoop_group: hadoop

# HBase installation directory
hbase_root_dir: /opt/tdp
hbase_install_dir: "{{ hbase_root_dir }}/hbase"

# Hadoop configuration directory
hadoop_conf_dir: /etc/hadoop/conf

# HBase configuration directories
hbase_root_conf_dir: /etc/hbase
hbase_master_conf_dir: "{{ hbase_root_conf_dir }}/conf.master"
hbase_rs_conf_dir: "{{ hbase_root_conf_dir }}/conf.rs"
hbase_rest_conf_dir: "{{ hbase_root_conf_dir }}/conf.rest"
hbase_client_conf_dir: "{{ hbase_root_conf_dir }}/conf"

# HBase pid directories
hbase_pid_dir: /var/run/hbase

# HBase logging directory
hbase_log_dir: /var/log/hbase

# SSL Keystore and Truststore
hbase_keystore_location: /etc/ssl/certs/keystore.jks
hbase_keystore_password: Keystore123!
hbase_truststore_location: /etc/ssl/certs/truststore.jks
hbase_truststore_password: Truststore123!

ssl_server:
  ssl.server.keystore.location: "{{ hbase_keystore_location }}"
  ssl.server.keystore.password: "{{ hbase_keystore_password }}"
  ssl.server.truststore.location: "{{ hbase_truststore_location }}"
  ssl.server.truststore.password: "{{ hbase_truststore_password }}"

# Properties
java_home: /usr/lib/jvm/jre-1.8.0-openjdk
hbase_zookeeper_quorum: |
  {{ groups['zk'] |
     map('tosit.tdp.access_fqdn', hostvars) |
     list |
     join(',') }}
hbase_zookeeper_client_port: "2181"

# hbase_site.xml - common
# TODO: make a hbase_site per service: master, rs, rest, client, phoenix queryserver
hbase_site:
  hbase.rootdir: hdfs://mycluster/hbase
  hbase.cluster.distributed: "true"
  hbase.zookeeper.quorum: "{{ hbase_zookeeper_quorum | trim }}"
  hbase.zookeeper.property.clientPort: "{{ hbase_zookeeper_client_port }}"
  hbase.zookeeper.property.authProvider.1: org.apache.zookeeper.server.auth.SASLAuthenticationProvider
  hbase.zookeeper.property.kerberos.removeHostFromPrincipal: "true"
  hbase.zookeeper.property.kerberos.removeRealmFromPrincipal: "true"
  hbase.ssl.enabled: "true"
  # hbase.security.authentication.ui: kerberos
  hbase.security.authentication: kerberos
  hbase.security.authorization: "true"
  hbase.master.keytab.file: /etc/security/keytabs/hbase.service.keytab
  hbase.master.kerberos.principal: "hbase/_HOST@{{ realm }}"
  hbase.regionserver.keytab.file: /etc/security/keytabs/hbase.service.keytab
  hbase.regionserver.kerberos.principal: "hbase/_HOST@{{ realm }}"
  hbase.rest.keytab.file: /etc/security/keytabs/hbase.service.keytab
  hbase.rest.kerberos.principal: "hbase/_HOST@{{ realm }}"
  hbase.rest.authentication.type: kerberos
  hbase.rest.authentication.kerberos.keytab: /etc/security/keytabs/spnego.service.keytab
  hbase.rest.authentication.kerberos.principal: "HTTP/_HOST@{{ realm }}"
  hbase.rest.support.proxyuser: "true"
  hbase.rest.ssl.enabled: "true"
  hbase.rest.ssl.keystore.store: "{{ hbase_keystore_location }}"
  hbase.rest.ssl.keystore.password: "{{ hbase_keystore_password }}"
  hbase.rest.port: 8080
  hbase.rest.info.port: 8085
  hbase.coprocessor.region.classes: org.apache.hadoop.hbase.security.token.TokenProvider

# JAAS principals need the FQDN
hbase_master_kerberos_principal: "hbase/{{ ansible_fqdn }}@{{ realm }}"
hbase_regionserver_kerberos_principal: "hbase/{{ ansible_fqdn }}@{{ realm }}"
hbase_rest_kerberos_principal: "hbase/{{ ansible_fqdn }}@{{ realm }}"

# HBase Ranger Plugin
ranger_hbase_release: ranger-2.0.1-TDP-0.1.0-SNAPSHOT-hbase-plugin
ranger_hbase_dist_file: "{{ ranger_hbase_release }}.tar.gz"
ranger_hbase_install_dir: "{{ hbase_root_dir }}/ranger-hbase-plugin"
ranger_hbase_install_properties:
  POLICY_MGR_URL: "https://{{ groups['ranger_admin'][0] | tosit.tdp.access_fqdn(hostvars) }}:6182"
  REPOSITORY_NAME: hbase-tdp
  audit_hdfs: hdfs://mycluster
  zookeeper_quorum: "{{ hbase_zookeeper_quorum | trim }}"
  zookeeper_port: "{{ hbase_zookeeper_client_port }}"

# Service restart policies
hbase_master_restart: "no"
hbase_rs_restart: "no"
hbase_rest_restart: "no"
phoenix_queryserver_restart: "no"

# Phoenix version
phoenix_release: phoenix-hbase-2.1-5.1.3-TDP-0.1.0-SNAPSHOT-bin
phoenix_server_release: phoenix-server-hbase-2.1-5.1.3-TDP-0.1.0-SNAPSHOT
phoenix_dist_file: "{{ phoenix_release }}.tar.gz"

phoenix_queryserver_release: phoenix-queryserver-6.0.0-TDP-0.1.0-SNAPSHOT
phoenix_queryserver_dist_file: "{{ phoenix_queryserver_release }}-bin.tar.gz"

# Phoenix installation directory
phoenix_root_dir: /opt/tdp
phoenix_install_dir: "{{ phoenix_root_dir }}/phoenix"

phoenix_queryserver_root_dir: /opt/tdp
phoenix_queryserver_install_dir: "{{ phoenix_queryserver_root_dir }}/phoenix-queryserver"

# Phoenix configuration directories
hbase_phoenix_queryserver_daemon_conf_dir: "{{ hbase_root_conf_dir }}/conf.phoenix-queryserver-daemon"
hbase_phoenix_queryserver_client_conf_dir: "{{ hbase_root_conf_dir }}/conf.phoenix-queryserver-client"

# Phoenix QueryServer user
phoenix_queryserver_user: phoenix_queryserver

# Phoenix QueryServer pid directories
phoenix_queryserver_pid_dir: /var/run/phoenix-queryserver

# HBase logging directory
phoenix_queryserver_log_dir: /var/log/phoenix-queryserver

# Phoenix tools expects all zookeeper server to use the same port
# And can take the port only once, at the end of the connection string
phoenix_zookeeper_quorum: "{{ hbase_zookeeper_quorum | trim }}:{{ hbase_zookeeper_client_port }}/"

phoenix_queryserver_hbase_site:
  phoenix.queryserver.keytab.file: /etc/security/keytabs/phoenixqueryserver.service.keytab
  phoenix.queryserver.kerberos.principal: "phoenixqueryserver/_HOST@{{ realm }}"
  phoenix.queryserver.http.keytab.file: /etc/security/keytabs/spnego.service.keytab
  phoenix.queryserver.http.kerberos.principal: "HTTP/_HOST@{{ realm }}"
  phoenix.queryserver.tls.enabled: "true"
  phoenix.queryserver.tls.keystore: "{{ hbase_keystore_location }}"
  phoenix.queryserver.tls.keystore.password: "{{ hbase_keystore_password }}"
  phoenix.queryserver.tls.truststore: "{{ hbase_truststore_location }}"
  phoenix.queryserver.tls.truststore.password: "{{ hbase_truststore_password }}"

phoenix_queryserver_properties: "{{ hbase_site | combine(phoenix_queryserver_hbase_site) }}"
